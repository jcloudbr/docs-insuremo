
<!doctype html>
<html lang="pt" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../">
      
      
        <link rel="next" href="../../premit/">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Recebimento do Prêmio (PREMRECEB) - Template de Documentação</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.342714a4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#recebimento-de-premio-premreceb-coinsurance" class="md-skip">
          Pular para conteúdo
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabeçalho">
    <a href="../../../.." title="Template de Documentação" class="md-header__button md-logo" aria-label="Template de Documentação" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Template de Documentação
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Recebimento do Prêmio (PREMRECEB)
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Buscar" placeholder="Buscar" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Pesquisar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpar" aria-label="Limpar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando busca
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navegação" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Template de Documentação" class="md-nav__button md-logo" aria-label="Template de Documentação" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Template de Documentação
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Coinsurance
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Coinsurance
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Visão geral do fluxo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Apólice
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Apólice
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Visão geral
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2_2_2" id="__nav_2_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Fluxos
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_2_2">
            <span class="md-nav__icon md-icon"></span>
            Fluxos
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../emissao-apolice-master-certificate.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Emissão da Apólice (Master/Certificate)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Recebimento do Prêmio (PREMRECEB)
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Recebimento do Prêmio (PREMRECEB)
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Índice">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Índice
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#visao-geral" class="md-nav__link">
    <span class="md-ellipsis">
      Visão geral
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#o-que-e-o-premreceb-no-negocio-susep-operacional" class="md-nav__link">
    <span class="md-ellipsis">
      O que é o PREMRECEB no negócio (SUSEP / operacional)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="O que é o PREMRECEB no negócio (SUSEP / operacional)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#o-que-ele-representa" class="md-nav__link">
    <span class="md-ellipsis">
      O que ele representa
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#para-que-ele-serve" class="md-nav__link">
    <span class="md-ellipsis">
      Para que ele serve
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#41-premreceb-recebimento-do-premio-por-parcela" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 PREMRECEB — Recebimento do prêmio (por parcela)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.1 PREMRECEB — Recebimento do prêmio (por parcela)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#codigo-e-entidade" class="md-nav__link">
    <span class="md-ellipsis">
      Código e entidade
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-ingestao-do-premreceb" class="md-nav__link">
    <span class="md-ellipsis">
      A) Ingestão do PREMRECEB
    </span>
  </a>
  
    <nav class="md-nav" aria-label="A) Ingestão do PREMRECEB">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-leitura-do-arquivo-s3" class="md-nav__link">
    <span class="md-ellipsis">
      1) Leitura do arquivo (S3)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-mapeamento-csv-entidade-cnspremreceb" class="md-nav__link">
    <span class="md-ellipsis">
      2) Mapeamento CSV → Entidade (CnsPremReceb)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-validacao-de-entrada" class="md-nav__link">
    <span class="md-ellipsis">
      3) Validação de entrada
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-pos-processamento-do-arquivo-movedelete" class="md-nav__link">
    <span class="md-ellipsis">
      4) Pós-processamento do arquivo (move/delete)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#b-processamento-dos-registros-pendentes-materializar-pagamento" class="md-nav__link">
    <span class="md-ellipsis">
      B) Processamento dos registros pendentes (materializar pagamento)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validacoes-e-decisoes-como-o-codigo-decide" class="md-nav__link">
    <span class="md-ellipsis">
      Validações e decisões (como o código decide)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Validações e decisões (como o código decide)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-master-policy-precisa-existir" class="md-nav__link">
    <span class="md-ellipsis">
      1) Master Policy precisa existir
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-certificate-policy-emitida-precisa-existir" class="md-nav__link">
    <span class="md-ellipsis">
      2) Certificate Policy emitida precisa existir
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-carrega-a-primeira-certificate-para-obter-policyno" class="md-nav__link">
    <span class="md-ellipsis">
      3) Carrega a primeira Certificate (para obter PolicyNo)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-endorsement-para-obter-endono" class="md-nav__link">
    <span class="md-ellipsis">
      4) Endorsement (para obter EndoNo)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integracao-com-bcp-registro-do-pagamento" class="md-nav__link">
    <span class="md-ellipsis">
      Integração com BCP (registro do pagamento)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Integração com BCP (registro do pagamento)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#como-o-premreceb-vira-payment-no-bcp" class="md-nav__link">
    <span class="md-ellipsis">
      Como o PREMRECEB vira Payment no BCP
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#atualizacao-de-status-sucesso-vs-erro" class="md-nav__link">
    <span class="md-ellipsis">
      Atualização de status (sucesso vs erro)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Atualização de status (sucesso vs erro)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sucesso" class="md-nav__link">
    <span class="md-ellipsis">
      Sucesso
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#erro" class="md-nav__link">
    <span class="md-ellipsis">
      Erro
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#depara-csv-arquivo-fisico-entidade-cnspremreceb" class="md-nav__link">
    <span class="md-ellipsis">
      De/Para — CSV (arquivo físico) → Entidade (CnsPremReceb)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#depara-defaults-e-rastreabilidade-como-o-registro-e-carimbado" class="md-nav__link">
    <span class="md-ellipsis">
      De/Para — Defaults e rastreabilidade (como o registro é “carimbado”)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#depara-entidade-bcp-payment-como-o-recebido-e-operacionalizado" class="md-nav__link">
    <span class="md-ellipsis">
      De/Para — Entidade → BCP Payment (como o “recebido” é operacionalizado)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tabelas-de-decisao-resumo-do-motor-premreceb" class="md-nav__link">
    <span class="md-ellipsis">
      Tabelas de decisão (resumo do motor PREMRECEB)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tabelas de decisão (resumo do motor PREMRECEB)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-pre-condicoes-para-registrar-pagamento" class="md-nav__link">
    <span class="md-ellipsis">
      A) Pré-condições para registrar pagamento
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pontos-pendentesincompletos-no-codigo-impacto-direto-no-negocio" class="md-nav__link">
    <span class="md-ellipsis">
      Pontos pendentes/incompletos no código (impacto direto no negócio)
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../premit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PREMIT
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../premrec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PREMREC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../premreceb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PREMRECEB
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resprem/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RESPREM
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_7" >
        
          
          <label class="md-nav__link" for="__nav_2_2_7" id="__nav_2_2_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    De/Para
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_7">
            <span class="md-nav__icon md-icon"></span>
            De/Para
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../depara/premit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PREMIT
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../depara/premrec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PREMREC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../depara/premreceb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PREMRECEB
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../depara/resprem/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RESPREM
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../depara/mapeamentos-internos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mapeamentos internos
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Sinistro
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Sinistro
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../sinistro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Visão geral
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../sinistro/sinav/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SINAV
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../sinistro/sinpend/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SINPEND
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../sinistro/sinpag/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SINPAG
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_5" >
        
          
          <label class="md-nav__link" for="__nav_2_3_5" id="__nav_2_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    De/Para
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_5">
            <span class="md-nav__icon md-icon"></span>
            De/Para
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../sinistro/depara/sinav/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SINAV
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../sinistro/depara/sinpend/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SINPEND
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../sinistro/depara/sinpag/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SINPAG
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Retornos (RO BMG)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Retornos (RO BMG)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../retornos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Visão geral
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../retornos/premac/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PREMAC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../retornos/premrecac/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PREMRECAC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../retornos/premrecebc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PREMRECEBC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../retornos/sinavac/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SINAVAC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../retornos/sinpendac/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SINPENDAC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../retornos/sinpagac/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SINPAGAC
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Índice">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Índice
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#visao-geral" class="md-nav__link">
    <span class="md-ellipsis">
      Visão geral
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#o-que-e-o-premreceb-no-negocio-susep-operacional" class="md-nav__link">
    <span class="md-ellipsis">
      O que é o PREMRECEB no negócio (SUSEP / operacional)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="O que é o PREMRECEB no negócio (SUSEP / operacional)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#o-que-ele-representa" class="md-nav__link">
    <span class="md-ellipsis">
      O que ele representa
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#para-que-ele-serve" class="md-nav__link">
    <span class="md-ellipsis">
      Para que ele serve
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#41-premreceb-recebimento-do-premio-por-parcela" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 PREMRECEB — Recebimento do prêmio (por parcela)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.1 PREMRECEB — Recebimento do prêmio (por parcela)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#codigo-e-entidade" class="md-nav__link">
    <span class="md-ellipsis">
      Código e entidade
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-ingestao-do-premreceb" class="md-nav__link">
    <span class="md-ellipsis">
      A) Ingestão do PREMRECEB
    </span>
  </a>
  
    <nav class="md-nav" aria-label="A) Ingestão do PREMRECEB">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-leitura-do-arquivo-s3" class="md-nav__link">
    <span class="md-ellipsis">
      1) Leitura do arquivo (S3)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-mapeamento-csv-entidade-cnspremreceb" class="md-nav__link">
    <span class="md-ellipsis">
      2) Mapeamento CSV → Entidade (CnsPremReceb)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-validacao-de-entrada" class="md-nav__link">
    <span class="md-ellipsis">
      3) Validação de entrada
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-pos-processamento-do-arquivo-movedelete" class="md-nav__link">
    <span class="md-ellipsis">
      4) Pós-processamento do arquivo (move/delete)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#b-processamento-dos-registros-pendentes-materializar-pagamento" class="md-nav__link">
    <span class="md-ellipsis">
      B) Processamento dos registros pendentes (materializar pagamento)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validacoes-e-decisoes-como-o-codigo-decide" class="md-nav__link">
    <span class="md-ellipsis">
      Validações e decisões (como o código decide)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Validações e decisões (como o código decide)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-master-policy-precisa-existir" class="md-nav__link">
    <span class="md-ellipsis">
      1) Master Policy precisa existir
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-certificate-policy-emitida-precisa-existir" class="md-nav__link">
    <span class="md-ellipsis">
      2) Certificate Policy emitida precisa existir
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-carrega-a-primeira-certificate-para-obter-policyno" class="md-nav__link">
    <span class="md-ellipsis">
      3) Carrega a primeira Certificate (para obter PolicyNo)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-endorsement-para-obter-endono" class="md-nav__link">
    <span class="md-ellipsis">
      4) Endorsement (para obter EndoNo)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integracao-com-bcp-registro-do-pagamento" class="md-nav__link">
    <span class="md-ellipsis">
      Integração com BCP (registro do pagamento)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Integração com BCP (registro do pagamento)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#como-o-premreceb-vira-payment-no-bcp" class="md-nav__link">
    <span class="md-ellipsis">
      Como o PREMRECEB vira Payment no BCP
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#atualizacao-de-status-sucesso-vs-erro" class="md-nav__link">
    <span class="md-ellipsis">
      Atualização de status (sucesso vs erro)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Atualização de status (sucesso vs erro)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sucesso" class="md-nav__link">
    <span class="md-ellipsis">
      Sucesso
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#erro" class="md-nav__link">
    <span class="md-ellipsis">
      Erro
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#depara-csv-arquivo-fisico-entidade-cnspremreceb" class="md-nav__link">
    <span class="md-ellipsis">
      De/Para — CSV (arquivo físico) → Entidade (CnsPremReceb)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#depara-defaults-e-rastreabilidade-como-o-registro-e-carimbado" class="md-nav__link">
    <span class="md-ellipsis">
      De/Para — Defaults e rastreabilidade (como o registro é “carimbado”)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#depara-entidade-bcp-payment-como-o-recebido-e-operacionalizado" class="md-nav__link">
    <span class="md-ellipsis">
      De/Para — Entidade → BCP Payment (como o “recebido” é operacionalizado)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tabelas-de-decisao-resumo-do-motor-premreceb" class="md-nav__link">
    <span class="md-ellipsis">
      Tabelas de decisão (resumo do motor PREMRECEB)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tabelas de decisão (resumo do motor PREMRECEB)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-pre-condicoes-para-registrar-pagamento" class="md-nav__link">
    <span class="md-ellipsis">
      A) Pré-condições para registrar pagamento
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pontos-pendentesincompletos-no-codigo-impacto-direto-no-negocio" class="md-nav__link">
    <span class="md-ellipsis">
      Pontos pendentes/incompletos no código (impacto direto no negócio)
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="recebimento-de-premio-premreceb-coinsurance">Recebimento de Prêmio — PREMRECEB (Coinsurance)<a class="headerlink" href="#recebimento-de-premio-premreceb-coinsurance" title="Permanent link">&para;</a></h1>
<blockquote>
<p><strong>Escopo:</strong> registrar o <strong>prêmio recebido</strong> (por parcela) e <strong>materializar o recebimento no BCP</strong> como <strong>Payment (boleto pago)</strong>, amarrado à apólice <strong>Certificate</strong> (e ao <strong>Endorsement</strong>, quando aplicável).<br />
<strong>Referências de código:</strong> <code>CoinsurancePremRecebService</code><br />
<strong>Entidades:</strong> <code>CnsPremReceb</code> (ingestão) + integração BCP (<code>Payment</code>, <code>PaymentDetail</code>)</p>
</blockquote>
<hr />
<h2 id="visao-geral">Visão geral<a class="headerlink" href="#visao-geral" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>PREMRECEB</strong> representa, no negócio, o <strong>evento de recebimento</strong> do prêmio (normalmente por boleto) — isto é: <strong>pagou</strong>.</li>
<li>No fluxo interno, ele funciona como “ponte” entre:</li>
<li><strong>o mundo SUSEP/arquivo</strong> (parcela recebida + dados bancários + valores)</li>
<li>e <strong>o mundo operacional</strong> (registrar no <strong>BCP</strong> como <code>Payment</code> com status <strong>Paid</strong>).</li>
<li>Diferente do PREMREC (parcelamento/cronograma), o PREMRECEB é o <strong>realizado</strong>: comprovação/registro de recebimento.</li>
</ul>
<hr />
<h2 id="o-que-e-o-premreceb-no-negocio-susep-operacional">O que é o PREMRECEB no negócio (SUSEP / operacional)<a class="headerlink" href="#o-que-e-o-premreceb-no-negocio-susep-operacional" title="Permanent link">&para;</a></h2>
<h3 id="o-que-ele-representa">O que ele representa<a class="headerlink" href="#o-que-ele-representa" title="Permanent link">&para;</a></h3>
<p>Um registro de <strong>prêmio efetivamente recebido</strong>, por parcela, contendo:
- a <strong>chave de negócio</strong> (ramo, apólice, endosso, proposta, movimento)
- dados de <strong>parcela</strong> (número, vencimento, data de recebimento)
- dados de <strong>cobrança</strong> (boleto, nosso número, documento, agência, banco)
- valores do título (valor do documento, desconto, multa, valor cobrado)</p>
<h3 id="para-que-ele-serve">Para que ele serve<a class="headerlink" href="#para-que-ele-serve" title="Permanent link">&para;</a></h3>
<p>Negocialmente, serve para:
- <strong>dar baixa financeira</strong> (parcela paga)
- permitir <strong>conciliação</strong> entre:
  - <strong>emitido/parcelado</strong> (PREMREC)
  - <strong>recebido</strong> (PREMRECEB)
- acionar a camada operacional (no seu caso, <strong>BCP</strong>) para registrar o pagamento como <strong>Payment Paid</strong>.</p>
<hr />
<h2 id="41-premreceb-recebimento-do-premio-por-parcela">4.1 PREMRECEB — Recebimento do prêmio (por parcela)<a class="headerlink" href="#41-premreceb-recebimento-do-premio-por-parcela" title="Permanent link">&para;</a></h2>
<h3 id="codigo-e-entidade">Código e entidade<a class="headerlink" href="#codigo-e-entidade" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Service:</strong> <code>CoinsurancePremRecebService</code></li>
<li><strong>Entidade:</strong> <code>CnsPremReceb</code></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Validação de entrada (OPA/Velora)</p>
<p>O service chama <code>veloraService.validate("bmg_prereceb", mapData)</code>.
As <strong>policies OPA/Velora</strong> ficam <strong>fora deste repositório</strong>.</p>
</div>
<hr />
<h2 id="a-ingestao-do-premreceb">A) Ingestão do PREMRECEB<a class="headerlink" href="#a-ingestao-do-premreceb" title="Permanent link">&para;</a></h2>
<h3 id="1-leitura-do-arquivo-s3">1) Leitura do arquivo (S3)<a class="headerlink" href="#1-leitura-do-arquivo-s3" title="Permanent link">&para;</a></h3>
<p>O service lista arquivos pendentes via:
- <code>s3FileService.listPendingProcessFiles(s3FileService.PREMRECEB)</code></p>
<p>Para cada arquivo:
- lê o conteúdo (<code>getResponseBundleFromKey</code>)
- transforma em bytes UTF-8
- faz parse CSV com delimitador <code>|</code>:
  - <code>csvReader.readFile("|", bytes)</code></p>
<h3 id="2-mapeamento-csv-entidade-cnspremreceb">2) Mapeamento CSV → Entidade (<code>CnsPremReceb</code>)<a class="headerlink" href="#2-mapeamento-csv-entidade-cnspremreceb" title="Permanent link">&para;</a></h3>
<p>O mapeamento é feito por <code>mapper</code> no código (tabela completa em <strong>De/Para</strong>).</p>
<p>Além disso, o código:
- carrega <code>declaredFields</code> da entidade para cast tipado (<code>castValue(...)</code>)
- injeta defaults (Status, FileId, FileName)</p>
<h3 id="3-validacao-de-entrada">3) Validação de entrada<a class="headerlink" href="#3-validacao-de-entrada" title="Permanent link">&para;</a></h3>
<p>Para cada linha do arquivo (<code>mapData</code>):
- <code>veloraService.validate("bmg_prereceb", mapData)</code>
- <strong>Se válido:</strong> <code>coinsuranceRepository.insertPremReceb(entity)</code>
- <strong>Se inválido:</strong> <code>processAsError(...)</code> (gera <code>CnsError</code>)</p>
<h3 id="4-pos-processamento-do-arquivo-movedelete">4) Pós-processamento do arquivo (move/delete)<a class="headerlink" href="#4-pos-processamento-do-arquivo-movedelete" title="Permanent link">&para;</a></h3>
<p>Depois de processar o arquivo:
- move para:
  - <code>processed/</code> se <strong>não houve erro</strong>
  - <code>error/</code> se <strong>houve erro</strong>
- e apaga o original (<code>deleteFile(key)</code>)</p>
<div class="admonition warning">
<p class="admonition-title">Risco operacional (marcação de erro do arquivo)</p>
<p>No código atual, a variável <code>hasError</code> depende do resultado de validação ao longo do loop.
Se houver mistura de linhas válidas e inválidas, a decisão de mover o arquivo inteiro para <code>processed/</code> ou <code>error/</code> pode ficar <strong>inconsistente</strong>.</p>
</div>
<hr />
<h2 id="b-processamento-dos-registros-pendentes-materializar-pagamento">B) Processamento dos registros pendentes (materializar pagamento)<a class="headerlink" href="#b-processamento-dos-registros-pendentes-materializar-pagamento" title="Permanent link">&para;</a></h2>
<p>Após a ingestão, o service processa registros <code>PENDING</code> a partir do índice:
- <code>coinsuranceRepository.searchByModuleAndStatusFromIndex(CnsPremRecebEntity, PENDING)</code>
- para cada registro: <code>processEntity(entity)</code></p>
<p>O objetivo dessa etapa é:</p>
<p>1) localizar a <strong>apólice definitiva</strong> (Master/Certificate) no módulo Policy</p>
<p>2) localizar <strong>endosso</strong> (quando aplicável)</p>
<p>3) registrar o recebimento no <strong>BCP</strong> como <strong>Payment Paid</strong></p>
<hr />
<h2 id="validacoes-e-decisoes-como-o-codigo-decide">Validações e decisões (como o código decide)<a class="headerlink" href="#validacoes-e-decisoes-como-o-codigo-decide" title="Permanent link">&para;</a></h2>
<h3 id="1-master-policy-precisa-existir">1) Master Policy precisa existir<a class="headerlink" href="#1-master-policy-precisa-existir" title="Permanent link">&para;</a></h3>
<p>O código tenta localizar a master:
- <code>fetchMasterPolicy(entity.PolicyNumber)</code></p>
<p><strong>Se não existir:</strong>
- erro: “Não existe uma Master Policy para a apólice …”
- <code>processAsError(entity, ERROR, ...)</code></p>
<div class="admonition warning">
<p class="admonition-title">Ponto crítico do código (TODO/hardcode)</p>
<p>No código atual, <code>fetchMasterPolicy(...)</code> está com <strong>TODO</strong> e usa <code>LeaderPolicyNo</code> hardcoded, em vez de usar plenamente o <code>entity.PolicyNumber</code>.</p>
</div>
<h3 id="2-certificate-policy-emitida-precisa-existir">2) Certificate Policy emitida precisa existir<a class="headerlink" href="#2-certificate-policy-emitida-precisa-existir" title="Permanent link">&para;</a></h3>
<p>O código valida se existe certificate emitida (no contexto da master):
- <code>existPolicyIssued(masterPolicy, entity)</code></p>
<p><strong>Se não existir:</strong>
- erro: “Não existe uma apólice criada para o ramo…, apólice…, proposta…”
- <code>processAsError(entity, ERROR, ...)</code></p>
<div class="admonition warning">
<p class="admonition-title">Ponto crítico do código (TODO/hardcode)</p>
<p><code>existPolicyIssued(...)</code> também contém <strong>TODO</strong> e, no estado atual, utiliza valores hardcoded para busca (ex.: ramo e leader policy).</p>
</div>
<h3 id="3-carrega-a-primeira-certificate-para-obter-policyno">3) Carrega a primeira Certificate (para obter PolicyNo)<a class="headerlink" href="#3-carrega-a-primeira-certificate-para-obter-policyno" title="Permanent link">&para;</a></h3>
<ul>
<li><code>fetchFirstCertificate(masterPolicy, entity)</code></li>
</ul>
<p>Se não achar:
- erro de “Não encontrada apólice para o ramo…, apólice…, proposta…”</p>
<h3 id="4-endorsement-para-obter-endono">4) Endorsement (para obter EndoNo)<a class="headerlink" href="#4-endorsement-para-obter-endono" title="Permanent link">&para;</a></h3>
<ul>
<li><code>fetchFirstEndorsement(certificatePolicy, entity)</code></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Ponto crítico do código (TODO/hardcode)</p>
<p><code>fetchFirstEndorsement(...)</code> está com <strong>TODO</strong> e faz buscas com IDs/PolicyNo hardcoded.
Isso impacta diretamente a capacidade de amarrar o recebimento ao endosso correto.</p>
</div>
<hr />
<h2 id="integracao-com-bcp-registro-do-pagamento">Integração com BCP (registro do pagamento)<a class="headerlink" href="#integracao-com-bcp-registro-do-pagamento" title="Permanent link">&para;</a></h2>
<p>Se passou nas validações, o código monta um <code>Payment</code> e envia para o BCP:
- <code>paymentApi().newSinglePaymentRequestBuilder().payment(payments).doRequest()</code></p>
<h3 id="como-o-premreceb-vira-payment-no-bcp">Como o PREMRECEB vira <code>Payment</code> no BCP<a class="headerlink" href="#como-o-premreceb-vira-payment-no-bcp" title="Permanent link">&para;</a></h3>
<ul>
<li><code>Payment.paymentMethod = "70"</code> → boleto</li>
<li><code>Payment.paymentStatus = "3"</code> → Paid</li>
<li><code>Payment.paymentType = "1"</code> → Direct Billing</li>
<li><code>Payment.currencyCode = "BRL"</code></li>
<li><code>Payment.policyNo = certificatePolicy.policyNo</code></li>
<li><code>Payment.endoNo = endo.endoNo</code> (se encontrado)</li>
</ul>
<hr />
<h2 id="atualizacao-de-status-sucesso-vs-erro">Atualização de status (sucesso vs erro)<a class="headerlink" href="#atualizacao-de-status-sucesso-vs-erro" title="Permanent link">&para;</a></h2>
<h3 id="sucesso">Sucesso<a class="headerlink" href="#sucesso" title="Permanent link">&para;</a></h3>
<ul>
<li>O código retorna <code>processedSuccessfully = true</code>.</li>
<li><strong>Mas</strong> o registro <code>CnsPremReceb</code> não é marcado como <code>COMPLETED</code> (não há update efetivo persistido nessa etapa).</li>
</ul>
<h3 id="erro">Erro<a class="headerlink" href="#erro" title="Permanent link">&para;</a></h3>
<ul>
<li><code>processAsError(...)</code>:</li>
<li>seta <code>entity.Status = ERROR</code></li>
<li><strong>não persiste</strong> a mudança (update está comentado): <code>// TODO coinsuranceRepository.updatePremReceb(entity)</code></li>
<li>grava <code>CnsError</code> (com <code>Status = COMPLETED</code>)</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Risco operacional (reprocessamento infinito)</p>
<p>Como o <code>updatePremReceb(...)</code> está comentado, registros podem permanecer <strong>PENDING</strong> no índice e serem <strong>reprocessados</strong> continuamente, mesmo após erro/sucesso.</p>
</div>
<hr />
<h2 id="depara-csv-arquivo-fisico-entidade-cnspremreceb">De/Para — CSV (arquivo físico) → Entidade (<code>CnsPremReceb</code>)<a class="headerlink" href="#depara-csv-arquivo-fisico-entidade-cnspremreceb" title="Permanent link">&para;</a></h2>
<blockquote>
<p><strong>Fonte:</strong> <code>Map&lt;String, String&gt; mapper</code> no <code>CoinsurancePremRecebService</code></p>
</blockquote>
<table>
<thead>
<tr>
<th>Campo no arquivo (CSV)</th>
<th>Campo salvo na entidade</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>SEQUENCIA</code></td>
<td><code>RecordNo</code></td>
</tr>
<tr>
<td><code>COD_CIA</code></td>
<td><code>CompanyCode</code></td>
</tr>
<tr>
<td><code>DT_BASE</code></td>
<td><code>BaseDate</code></td>
</tr>
<tr>
<td><code>TIPO_MOV</code></td>
<td><code>MovementType</code></td>
</tr>
<tr>
<td><code>COD_RAMO</code></td>
<td><code>BranchCode</code></td>
</tr>
<tr>
<td><code>NUM_APOL</code></td>
<td><code>PolicyNumber</code></td>
</tr>
<tr>
<td><code>NUM_END</code></td>
<td><code>EndorsementNumber</code></td>
</tr>
<tr>
<td><code>NUM_PROP</code></td>
<td><code>ProposalNumber</code></td>
</tr>
<tr>
<td><code>DT_PROP</code></td>
<td><code>ProposalDate</code></td>
</tr>
<tr>
<td><code>PRESTACAO</code></td>
<td><code>InstallmentNumber</code></td>
</tr>
<tr>
<td><code>DT_REC_PRE</code></td>
<td><code>InstallmentReceiptDate</code></td>
</tr>
<tr>
<td><code>DT_VEN_PRE</code></td>
<td><code>InstallmentDueDate</code></td>
</tr>
<tr>
<td><code>NUM_BAN</code></td>
<td><code>BankNumber</code></td>
</tr>
<tr>
<td><code>CNPJ_BAN</code></td>
<td><code>BankDocumentId</code></td>
</tr>
<tr>
<td><code>NUM_BOL</code></td>
<td><code>TicketNumber</code></td>
</tr>
<tr>
<td><code>NUM_DOC</code></td>
<td><code>DocumentNumber</code></td>
</tr>
<tr>
<td><code>NUM_AGE</code></td>
<td><code>AgencyNumber</code></td>
</tr>
<tr>
<td><code>NUM_NOS</code></td>
<td><code>OurNumber</code></td>
</tr>
<tr>
<td><code>VAL_DOC</code></td>
<td><code>DocumentValue</code></td>
</tr>
<tr>
<td><code>VAL_DESC</code></td>
<td><code>DiscountValue</code></td>
</tr>
<tr>
<td><code>VAL_MUL</code></td>
<td><code>FineValue</code></td>
</tr>
<tr>
<td><code>VAL_COB</code></td>
<td><code>ChargedValue</code></td>
</tr>
<tr>
<td><code>DS_GRUPO_RAMO</code></td>
<td><code>BranchGroupDescription</code></td>
</tr>
<tr>
<td><code>CD_PRODUTO</code></td>
<td><code>ProductCode</code></td>
</tr>
<tr>
<td><code>DS_PRODUTO</code></td>
<td><code>ProductDescription</code></td>
</tr>
<tr>
<td><code>CD_BU</code></td>
<td><code>BusinessUnitCode</code></td>
</tr>
<tr>
<td><code>DS_BU</code></td>
<td><code>BusinessUnitDescription</code></td>
</tr>
<tr>
<td><code>CD_OPERACAO</code></td>
<td><code>OperationCode</code></td>
</tr>
<tr>
<td><code>CD_CARTEIRA</code></td>
<td><code>WalletCode</code></td>
</tr>
<tr>
<td><code>DS_CARTEIRA</code></td>
<td><code>WalletDescription</code></td>
</tr>
<tr>
<td><code>CD_SUCURSAL</code></td>
<td><code>SucursalCode</code></td>
</tr>
<tr>
<td><code>FG_GEB</code></td>
<td><code>FgGeb</code></td>
</tr>
<tr>
<td><code>DCR_TIP_OPER</code></td>
<td><code>OperationDescription</code></td>
</tr>
<tr>
<td><code>DS_ORIGEM</code></td>
<td><code>OriginDescription</code></td>
</tr>
</tbody>
</table>
<hr />
<h2 id="depara-defaults-e-rastreabilidade-como-o-registro-e-carimbado">De/Para — Defaults e rastreabilidade (como o registro é “carimbado”)<a class="headerlink" href="#depara-defaults-e-rastreabilidade-como-o-registro-e-carimbado" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Campo interno</th>
<th>Como é preenchido no código</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Status</code></td>
<td><code>PENDING</code></td>
</tr>
<tr>
<td><code>FileName</code></td>
<td>nome do arquivo (<code>key.split("/").last()</code>)</td>
</tr>
<tr>
<td><code>FileId</code></td>
<td><code>"{etagSemAspas}_{RecordNo}"</code></td>
</tr>
</tbody>
</table>
<hr />
<h2 id="depara-entidade-bcp-payment-como-o-recebido-e-operacionalizado">De/Para — Entidade → BCP Payment (como o “recebido” é operacionalizado)<a class="headerlink" href="#depara-entidade-bcp-payment-como-o-recebido-e-operacionalizado" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Origem</th>
<th>Campo</th>
<th>Destino BCP</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CnsPremReceb</code></td>
<td><code>DocumentValue</code></td>
<td><code>Payment.amount</code> e <code>PaymentDetail.amount</code></td>
</tr>
<tr>
<td><code>CnsPremReceb</code></td>
<td><code>BankNumber</code></td>
<td><code>Payment.bankCode</code></td>
</tr>
<tr>
<td><code>CnsPremReceb</code></td>
<td><code>OurNumber</code></td>
<td><code>Payment.bankAccountNo</code></td>
</tr>
<tr>
<td><code>CnsPremReceb</code></td>
<td><code>AgencyNumber</code></td>
<td><code>Payment.insurerAccountCode</code></td>
</tr>
<tr>
<td><code>CnsPremReceb</code></td>
<td><code>TicketNumber</code></td>
<td><code>Payment.paymentNo</code></td>
</tr>
<tr>
<td><code>Certificate Policy</code></td>
<td><code>policyNo</code></td>
<td><code>Payment.policyNo</code></td>
</tr>
<tr>
<td><code>Endorsement</code></td>
<td><code>endoNo</code></td>
<td><code>Payment.endoNo</code></td>
</tr>
<tr>
<td>Constante</td>
<td><code>"70"</code></td>
<td><code>Payment.paymentMethod</code> (boleto)</td>
</tr>
<tr>
<td>Constante</td>
<td><code>"3"</code></td>
<td><code>Payment.paymentStatus</code> (Paid)</td>
</tr>
<tr>
<td>Constante</td>
<td><code>"1"</code></td>
<td><code>Payment.paymentType</code> (Direct Billing)</td>
</tr>
<tr>
<td>Constante</td>
<td><code>"BRL"</code></td>
<td><code>Payment.currencyCode</code> / <code>PaymentDetail.currencyCode</code></td>
</tr>
</tbody>
</table>
<hr />
<h2 id="tabelas-de-decisao-resumo-do-motor-premreceb">Tabelas de decisão (resumo do motor PREMRECEB)<a class="headerlink" href="#tabelas-de-decisao-resumo-do-motor-premreceb" title="Permanent link">&para;</a></h2>
<h3 id="a-pre-condicoes-para-registrar-pagamento">A) Pré-condições para registrar pagamento<a class="headerlink" href="#a-pre-condicoes-para-registrar-pagamento" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Condição</th>
<th>Ação</th>
<th>Resultado</th>
</tr>
</thead>
<tbody>
<tr>
<td>Master Policy não encontrada</td>
<td><code>processAsError(ERROR)</code></td>
<td>Não registra no BCP</td>
</tr>
<tr>
<td>Certificate emitida não existe</td>
<td><code>processAsError(ERROR)</code></td>
<td>Não registra no BCP</td>
</tr>
<tr>
<td>Certificate não carregou</td>
<td><code>processAsError(ERROR)</code></td>
<td>Não registra no BCP</td>
</tr>
<tr>
<td>Tudo OK</td>
<td>Monta <code>Payment</code> e chama BCP</td>
<td>Registra <code>Payment</code> como <strong>Paid</strong></td>
</tr>
</tbody>
</table>
<hr />
<h2 id="pontos-pendentesincompletos-no-codigo-impacto-direto-no-negocio">Pontos pendentes/incompletos no código (impacto direto no negócio)<a class="headerlink" href="#pontos-pendentesincompletos-no-codigo-impacto-direto-no-negocio" title="Permanent link">&para;</a></h2>
<p>1) <strong>Lookup de apólice com valores hardcoded (TODO)</strong>
- Master/Certificate/Endorsement ainda não usam plenamente a chave do arquivo (<code>BranchCode</code>, <code>PolicyNumber</code>, <code>EndorsementNumber</code>, <code>ProposalNumber</code>).</p>
<p>2) <strong>Status do registro não é atualizado</strong>
- <code>updatePremReceb(entity)</code> está comentado, então o registro pode permanecer <code>PENDING</code> e reprocessar indefinidamente.</p>
<p>3) <strong>Marcação de sucesso do arquivo pode ser inconsistente</strong>
- A decisão de mover para <code>processed/</code> ou <code>error/</code> pode não refletir corretamente um arquivo com linhas mistas (válidas e inválidas).</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": [], "search": "../../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copiado para \u00e1rea de transfer\u00eancia", "clipboard.copy": "Copiar para \u00e1rea de transfer\u00eancia", "search.result.more.one": "mais 1 nesta p\u00e1gina", "search.result.more.other": "# mais nesta p\u00e1gina", "search.result.none": "Nenhum documento encontrado", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Digite para iniciar a busca", "search.result.term.missing": "Ausente", "select.version": "Selecione a vers\u00e3o"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>